{"expireTime":9007200828410573000,"key":"gatsby-plugin-mdx-entire-payload-e97dea312187acbc82d7249b2e4fc28f-/ibm-garage-developer-guide","val":{"mdast":{"type":"root","children":[{"type":"import","value":"import DefaultLayout from \"/home/jenkins/workspace/dev/dev-ibm-garage-cloud.ibm-garage-developer-guide.sms-pipeline/node_modules/gatsby-theme-carbon/src/templates/Default.js\"","position":{"start":{"line":3,"column":1,"offset":2},"end":{"line":3,"column":175,"offset":176},"indent":[]}},{"type":"export","default":true,"value":"export default DefaultLayout","position":{"start":{"line":5,"column":1,"offset":178},"end":{"line":5,"column":29,"offset":206},"indent":[]}},{"type":"jsx","value":"<PageDescription>","position":{"start":{"line":8,"column":1,"offset":209},"end":{"line":8,"column":18,"offset":226},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Use Pact to test your code's API","position":{"start":{"line":10,"column":1,"offset":228},"end":{"line":10,"column":33,"offset":260},"indent":[]}}],"position":{"start":{"line":10,"column":1,"offset":228},"end":{"line":10,"column":33,"offset":260},"indent":[]}},{"type":"jsx","value":"</PageDescription>","position":{"start":{"line":12,"column":1,"offset":262},"end":{"line":12,"column":19,"offset":280},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In IBM Garage Method, one of the Develop practices is ","position":{"start":{"line":14,"column":1,"offset":282},"end":{"line":14,"column":55,"offset":336},"indent":[]}},{"type":"link","title":null,"url":"https://www.ibm.com/garage/method/practices/code/contract-driven-testing","children":[{"type":"text","value":"contract-driven testing","position":{"start":{"line":14,"column":56,"offset":337},"end":{"line":14,"column":79,"offset":360},"indent":[]}}],"position":{"start":{"line":14,"column":55,"offset":336},"end":{"line":14,"column":154,"offset":435},"indent":[]}},{"type":"text","value":".\nPact automates contract testing and enables it to be added to a continuous integration pipeline.\nThe Developer Tools environment's Jenkins pipeline includes a Pact stage. \nSimply by building your app using the Jenkins pipeline, your code's contract gets tested, just open the Pact UI to browse the results.","position":{"start":{"line":14,"column":154,"offset":435},"end":{"line":17,"column":135,"offset":743},"indent":[1,1,1]}}],"position":{"start":{"line":14,"column":1,"offset":282},"end":{"line":17,"column":135,"offset":743},"indent":[1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"What is contract testing","position":{"start":{"line":19,"column":4,"offset":748},"end":{"line":19,"column":28,"offset":772},"indent":[]}}],"position":{"start":{"line":19,"column":1,"offset":745},"end":{"line":19,"column":28,"offset":772},"indent":[]}},{"type":"paragraph","children":[{"type":"emphasis","children":[{"type":"text","value":"Contract testing","position":{"start":{"line":21,"column":2,"offset":775},"end":{"line":21,"column":18,"offset":791},"indent":[]}}],"position":{"start":{"line":21,"column":1,"offset":774},"end":{"line":21,"column":19,"offset":792},"indent":[]}},{"type":"text","value":" is a testing discipline that ensures two applications (a consumer and\na provider) have a shared understanding of the interactions or the ","position":{"start":{"line":21,"column":19,"offset":792},"end":{"line":22,"column":68,"offset":930},"indent":[1]}},{"type":"emphasis","children":[{"type":"text","value":"contract","position":{"start":{"line":22,"column":69,"offset":931},"end":{"line":22,"column":77,"offset":939},"indent":[]}}],"position":{"start":{"line":22,"column":68,"offset":930},"end":{"line":22,"column":78,"offset":940},"indent":[]}},{"type":"text","value":" between them.","position":{"start":{"line":22,"column":78,"offset":940},"end":{"line":22,"column":92,"offset":954},"indent":[]}}],"position":{"start":{"line":21,"column":1,"offset":774},"end":{"line":22,"column":92,"offset":954},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"The Pact framework has been selected for the provided tool set. Pact is a \nconsumer-driven contract testing framework. More details can be found here -\n","position":{"start":{"line":24,"column":1,"offset":956},"end":{"line":26,"column":1,"offset":1108},"indent":[1,1]}},{"type":"link","title":null,"url":"https://docs.pact.io/","children":[{"type":"text","value":"Pact overview","position":{"start":{"line":26,"column":2,"offset":1109},"end":{"line":26,"column":15,"offset":1122},"indent":[]}}],"position":{"start":{"line":26,"column":1,"offset":1108},"end":{"line":26,"column":39,"offset":1146},"indent":[]}},{"type":"text","value":". The framework has been built into the Starter Kits \nand a Pact Broker instance is provisioned in the cluster along with the other tools.","position":{"start":{"line":26,"column":39,"offset":1146},"end":{"line":27,"column":85,"offset":1284},"indent":[1]}}],"position":{"start":{"line":24,"column":1,"offset":956},"end":{"line":27,"column":85,"offset":1284},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"In ","position":{"start":{"line":29,"column":1,"offset":1286},"end":{"line":29,"column":4,"offset":1289},"indent":[]}},{"type":"inlineCode","value":"consumer-driven contract testing","position":{"start":{"line":29,"column":4,"offset":1289},"end":{"line":29,"column":38,"offset":1323},"indent":[]}},{"type":"text","value":" it is the consumer who defines the ","position":{"start":{"line":29,"column":38,"offset":1323},"end":{"line":29,"column":74,"offset":1359},"indent":[]}},{"type":"inlineCode","value":"contract","position":{"start":{"line":29,"column":74,"offset":1359},"end":{"line":29,"column":84,"offset":1369},"indent":[]}},{"type":"text","value":" in terms of the \nexpected interactions, the data structure, and the expected responses. That ","position":{"start":{"line":29,"column":84,"offset":1369},"end":{"line":30,"column":77,"offset":1463},"indent":[1]}},{"type":"inlineCode","value":"contract","position":{"start":{"line":30,"column":77,"offset":1463},"end":{"line":30,"column":87,"offset":1473},"indent":[]}},{"type":"text","value":" can then be used\non the consumer-side to mock the interactions and validate the consumer behavior. More importantly,\nthe ","position":{"start":{"line":30,"column":87,"offset":1473},"end":{"line":32,"column":5,"offset":1595},"indent":[1,1]}},{"type":"inlineCode","value":"contract","position":{"start":{"line":32,"column":5,"offset":1595},"end":{"line":32,"column":15,"offset":1605},"indent":[]}},{"type":"text","value":" can be shared with the provider of the interaction so that the provider's responses\ncan be validated to ensure the consumer's expectations are met.","position":{"start":{"line":32,"column":15,"offset":1605},"end":{"line":33,"column":64,"offset":1753},"indent":[1]}}],"position":{"start":{"line":29,"column":1,"offset":1286},"end":{"line":33,"column":64,"offset":1753},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"In the Pact framework, the contract is called a ","position":{"start":{"line":35,"column":1,"offset":1755},"end":{"line":35,"column":49,"offset":1803},"indent":[]}},{"type":"inlineCode","value":"pact","position":{"start":{"line":35,"column":49,"offset":1803},"end":{"line":35,"column":55,"offset":1809},"indent":[]}},{"type":"text","value":". A ","position":{"start":{"line":35,"column":55,"offset":1809},"end":{"line":35,"column":59,"offset":1813},"indent":[]}},{"type":"inlineCode","value":"pact","position":{"start":{"line":35,"column":59,"offset":1813},"end":{"line":35,"column":65,"offset":1819},"indent":[]}},{"type":"text","value":" consists of one or more\n","position":{"start":{"line":35,"column":65,"offset":1819},"end":{"line":36,"column":1,"offset":1844},"indent":[1]}},{"type":"inlineCode","value":"interactions","position":{"start":{"line":36,"column":1,"offset":1844},"end":{"line":36,"column":15,"offset":1858},"indent":[]}},{"type":"text","value":". Each ","position":{"start":{"line":36,"column":15,"offset":1858},"end":{"line":36,"column":22,"offset":1865},"indent":[]}},{"type":"inlineCode","value":"interaction","position":{"start":{"line":36,"column":22,"offset":1865},"end":{"line":36,"column":35,"offset":1878},"indent":[]}},{"type":"text","value":" has the following structure:","position":{"start":{"line":36,"column":35,"offset":1878},"end":{"line":36,"column":64,"offset":1907},"indent":[]}}],"position":{"start":{"line":35,"column":1,"offset":1755},"end":{"line":36,"column":64,"offset":1907},"indent":[1]}},{"type":"code","lang":null,"meta":null,"value":"Given a *state* of {state}\n\n*upon receiving* a {description} request\n\n*with request* parameters\n- HTTP method\n- path\n- headers\n- body\n\n*will respond with* values like\n- status\n- headers\n- body","position":{"start":{"line":38,"column":1,"offset":1909},"end":{"line":53,"column":4,"offset":2109},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"where:","position":{"start":{"line":55,"column":1,"offset":2111},"end":{"line":55,"column":7,"offset":2117},"indent":[]}}],"position":{"start":{"line":55,"column":1,"offset":2111},"end":{"line":55,"column":7,"offset":2117},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"{state} is an optional string that describes the initial state. This value can be used by the\nprovider during testing to make sure the preconditions are met","position":{"start":{"line":56,"column":3,"offset":2120},"end":{"line":57,"column":63,"offset":2276},"indent":[1]}}],"position":{"start":{"line":56,"column":3,"offset":2120},"end":{"line":57,"column":63,"offset":2276},"indent":[1]}}],"position":{"start":{"line":56,"column":1,"offset":2118},"end":{"line":57,"column":63,"offset":2276},"indent":[1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"{description} is a unique description of the interaction","position":{"start":{"line":58,"column":3,"offset":2279},"end":{"line":58,"column":59,"offset":2335},"indent":[]}}],"position":{"start":{"line":58,"column":3,"offset":2279},"end":{"line":58,"column":59,"offset":2335},"indent":[]}}],"position":{"start":{"line":58,"column":1,"offset":2277},"end":{"line":58,"column":59,"offset":2335},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"the request parameters can contain any values that describe the interaction","position":{"start":{"line":59,"column":3,"offset":2338},"end":{"line":59,"column":78,"offset":2413},"indent":[]}}],"position":{"start":{"line":59,"column":3,"offset":2338},"end":{"line":59,"column":78,"offset":2413},"indent":[]}}],"position":{"start":{"line":59,"column":1,"offset":2336},"end":{"line":59,"column":78,"offset":2413},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"the response contains the relevant information for the consumer. The response values can be exact values\nor using matchers for type, regular expressions, etc","position":{"start":{"line":60,"column":3,"offset":2416},"end":{"line":61,"column":53,"offset":2573},"indent":[1]}}],"position":{"start":{"line":60,"column":3,"offset":2416},"end":{"line":61,"column":53,"offset":2573},"indent":[1]}}],"position":{"start":{"line":60,"column":1,"offset":2414},"end":{"line":61,"column":53,"offset":2573},"indent":[1]}}],"position":{"start":{"line":56,"column":1,"offset":2118},"end":{"line":61,"column":53,"offset":2573},"indent":[1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Consumer","position":{"start":{"line":63,"column":4,"offset":2578},"end":{"line":63,"column":12,"offset":2586},"indent":[]}}],"position":{"start":{"line":63,"column":1,"offset":2575},"end":{"line":63,"column":12,"offset":2586},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Using the Pact framework libraries in conjunction with the unit testing framework on the consumer, the\n","position":{"start":{"line":65,"column":1,"offset":2588},"end":{"line":66,"column":1,"offset":2691},"indent":[1]}},{"type":"inlineCode","value":"pact","position":{"start":{"line":66,"column":1,"offset":2691},"end":{"line":66,"column":7,"offset":2697},"indent":[]}},{"type":"text","value":" for the interaction between the consumer and provider is generated and validated. As part of the\npact test setup, a Pact server is started and configured with the expected interactions. All of the consumer\nservice invocations are directed at the Pact server which provides mock responses based on the \ninteractions defined by the ","position":{"start":{"line":66,"column":7,"offset":2697},"end":{"line":69,"column":29,"offset":3028},"indent":[1,1,1]}},{"type":"inlineCode","value":"pact","position":{"start":{"line":69,"column":29,"offset":3028},"end":{"line":69,"column":35,"offset":3034},"indent":[]}},{"type":"text","value":". At the end of the test, if all the interactions completed successfully\na file containing the pact definition is generated.","position":{"start":{"line":69,"column":35,"offset":3034},"end":{"line":70,"column":52,"offset":3158},"indent":[1]}}],"position":{"start":{"line":65,"column":1,"offset":2588},"end":{"line":70,"column":52,"offset":3158},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The following diagram gives an overview of the consumer interactions:\n","position":{"start":{"line":72,"column":1,"offset":3160},"end":{"line":73,"column":1,"offset":3230},"indent":[1]}},{"type":"image","title":null,"url":"./PactFramework-consumer.png","alt":"Pact consumer interactions","position":{"start":{"line":73,"column":1,"offset":3230},"end":{"line":73,"column":60,"offset":3289},"indent":[]}}],"position":{"start":{"line":72,"column":1,"offset":3160},"end":{"line":73,"column":60,"offset":3289},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"An example pact test on a Typescript consumer using the jest testing framework is provided below. It has\nbeen broken into several parts.","position":{"start":{"line":75,"column":1,"offset":3291},"end":{"line":76,"column":32,"offset":3427},"indent":[1]}}],"position":{"start":{"line":75,"column":1,"offset":3291},"end":{"line":76,"column":32,"offset":3427},"indent":[1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Pact server config","position":{"start":{"line":78,"column":5,"offset":3433},"end":{"line":78,"column":23,"offset":3451},"indent":[]}}],"position":{"start":{"line":78,"column":1,"offset":3429},"end":{"line":78,"column":23,"offset":3451},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"At the beginning of the test file, the pact server is configured and started in the\n","position":{"start":{"line":80,"column":1,"offset":3453},"end":{"line":81,"column":1,"offset":3537},"indent":[1]}},{"type":"inlineCode","value":"beforeAll()","position":{"start":{"line":81,"column":1,"offset":3537},"end":{"line":81,"column":14,"offset":3550},"indent":[]}},{"type":"text","value":" block. The ","position":{"start":{"line":81,"column":14,"offset":3550},"end":{"line":81,"column":26,"offset":3562},"indent":[]}},{"type":"inlineCode","value":"afterAll()","position":{"start":{"line":81,"column":26,"offset":3562},"end":{"line":81,"column":38,"offset":3574},"indent":[]}},{"type":"text","value":" block finalizes the pacts by writing them out\nto a file and stopping the pact server.","position":{"start":{"line":81,"column":38,"offset":3574},"end":{"line":82,"column":40,"offset":3660},"indent":[1]}}],"position":{"start":{"line":80,"column":1,"offset":3453},"end":{"line":82,"column":40,"offset":3660},"indent":[1,1]}},{"type":"code","lang":"typescript","meta":null,"value":"  const port = 1234;\n  const baseUrl = `http://localhost:${port}`;\n  let pact: Pact;\n  beforeAll(() => {\n    pact = new Pact({\n      consumer: consumerName,\n      provider: providerName,\n      logLevel: 'error',\n      port,\n    });\n\n    return pact.setup();\n  });\n\n  afterAll(() => {\n    return pact.finalize()\n      .catch(err => console.error('Error finalizing pact', err));\n  });","position":{"start":{"line":84,"column":1,"offset":3662},"end":{"line":103,"column":4,"offset":4062},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Setup the service","position":{"start":{"line":105,"column":5,"offset":4068},"end":{"line":105,"column":22,"offset":4085},"indent":[]}}],"position":{"start":{"line":105,"column":1,"offset":4064},"end":{"line":105,"column":22,"offset":4085},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Next, an instance of the component that will be tested is loaded and configured with the \npact server host and port as the base url used for the interactions. In this example,\nthe consumer is using the ","position":{"start":{"line":107,"column":1,"offset":4087},"end":{"line":109,"column":27,"offset":4289},"indent":[1,1]}},{"type":"inlineCode","value":"typescript-ioc","position":{"start":{"line":109,"column":27,"offset":4289},"end":{"line":109,"column":43,"offset":4305},"indent":[]}},{"type":"text","value":" library to inject the ","position":{"start":{"line":109,"column":43,"offset":4305},"end":{"line":109,"column":66,"offset":4328},"indent":[]}},{"type":"inlineCode","value":"baseUrl","position":{"start":{"line":109,"column":66,"offset":4328},"end":{"line":109,"column":75,"offset":4337},"indent":[]}},{"type":"text","value":" config value \ninto the service.","position":{"start":{"line":109,"column":75,"offset":4337},"end":{"line":110,"column":18,"offset":4369},"indent":[1]}}],"position":{"start":{"line":107,"column":1,"offset":4087},"end":{"line":110,"column":18,"offset":4369},"indent":[1,1,1]}},{"type":"code","lang":"typescript","meta":null,"value":"  let service: SampleApi;\n  beforeAll(() => {\n    Container\n      .bind(MyServiceConfig)\n      .provider({get: () => ({baseUrl})});\n    \n    service = Container.get(SampleService);\n  });","position":{"start":{"line":112,"column":1,"offset":4371},"end":{"line":121,"column":4,"offset":4577},"indent":[1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Define and test the interaction","position":{"start":{"line":123,"column":5,"offset":4583},"end":{"line":123,"column":36,"offset":4614},"indent":[]}}],"position":{"start":{"line":123,"column":1,"offset":4579},"end":{"line":123,"column":36,"offset":4614},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"For each interaction with the provider, a test similar to the one provided below is created. In\nit, the Pact framework is used to define the interaction. The ","position":{"start":{"line":125,"column":1,"offset":4616},"end":{"line":126,"column":63,"offset":4774},"indent":[1]}},{"type":"inlineCode","value":"addInteraction()","position":{"start":{"line":126,"column":63,"offset":4774},"end":{"line":126,"column":81,"offset":4792},"indent":[]}},{"type":"text","value":" publishes the\ninteraction to the Pact server so that it can be used to provide a mock response when the\nrequest is made.","position":{"start":{"line":126,"column":81,"offset":4792},"end":{"line":128,"column":17,"offset":4913},"indent":[1,1]}}],"position":{"start":{"line":125,"column":1,"offset":4616},"end":{"line":128,"column":17,"offset":4913},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The mock response is then used to validate the behavior of the component that is being tested.\nThe example below is simple and passes the provider response directly through the service api\nbut in more sophisticated examples the value would be transformed.","position":{"start":{"line":130,"column":1,"offset":4915},"end":{"line":132,"column":67,"offset":5170},"indent":[1,1]}}],"position":{"start":{"line":130,"column":1,"offset":4915},"end":{"line":132,"column":67,"offset":5170},"indent":[1,1]}},{"type":"code","lang":"typescript","meta":null,"value":"  describe('given createWidget()', () => {\n    context('when called with valid request', () => {\n      const widgetRequest = {...};\n      const widgetResponse = {...};\n      \n      beforeEach(() => {\n        return pact.addInteraction({\n          uponReceiving: 'a valid widget request',\n          withRequest: {\n            method: 'POST',\n            path: '/widgets',\n            headers: {\n              'Content-Type': 'application/json',\n              'Accept': 'application/json',\n            },\n            body: widgetRequest,\n          },\n          willRespondWith: {\n            status: 200,\n            headers: {\n              'Content-Type': Matchers.regex({\n                generate: 'application/json', matcher: 'application/json.*'\n              }),\n            },\n            body: Matchers.like(widgetResponse),\n          },\n        });\n      });\n\n      test('then return 200 status', async () => {\n        expect(await service.createWidget(widgetRequest)).toEqual(widgetResponse);\n      });\n    });\n  });","position":{"start":{"line":134,"column":1,"offset":5172},"end":{"line":169,"column":4,"offset":6214},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Provider","position":{"start":{"line":171,"column":4,"offset":6219},"end":{"line":171,"column":12,"offset":6227},"indent":[]}}],"position":{"start":{"line":171,"column":1,"offset":6216},"end":{"line":171,"column":12,"offset":6227},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The provider uses the Pact framework to verify the running server against the ","position":{"start":{"line":173,"column":1,"offset":6229},"end":{"line":173,"column":79,"offset":6307},"indent":[]}},{"type":"inlineCode","value":"pact","position":{"start":{"line":173,"column":79,"offset":6307},"end":{"line":173,"column":85,"offset":6313},"indent":[]}},{"type":"text","value":", either\none started locally as part of the test or another instance running elsewhere. The interactions\nin the pact are sent to the provider by a mock consumer in the Pact framework and the results\nare verified against the expected results defined by the pact.","position":{"start":{"line":173,"column":85,"offset":6313},"end":{"line":176,"column":63,"offset":6574},"indent":[1,1,1]}}],"position":{"start":{"line":173,"column":1,"offset":6229},"end":{"line":176,"column":63,"offset":6574},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"As an optional configuration for the verification process, an endpoint can be provided that handles\nthe state information in the pact in order to ensure the preconditions for the test are met. (E.g.\nstate=\"given an empty database\"). In order for these tests to be repeatable, it is often advisable\nto stand up a clean backend to run the pact tests when the tests start and tear it down when the\ntests are completed. For example, if a provider interacts with a Cloudant database point the \ntest provider at a new database instance for the tests.","position":{"start":{"line":178,"column":1,"offset":6576},"end":{"line":183,"column":56,"offset":7120},"indent":[1,1,1,1,1]}}],"position":{"start":{"line":178,"column":1,"offset":6576},"end":{"line":183,"column":56,"offset":7120},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The following diagram shows the interactions for the pact provider:\n","position":{"start":{"line":185,"column":1,"offset":7122},"end":{"line":186,"column":1,"offset":7190},"indent":[1]}},{"type":"image","title":null,"url":"./PactFramework-provider.png","alt":"Pact provider interactions","position":{"start":{"line":186,"column":1,"offset":7190},"end":{"line":186,"column":60,"offset":7249},"indent":[]}}],"position":{"start":{"line":185,"column":1,"offset":7122},"end":{"line":186,"column":60,"offset":7249},"indent":[1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Pact Broker","position":{"start":{"line":188,"column":4,"offset":7254},"end":{"line":188,"column":15,"offset":7265},"indent":[]}}],"position":{"start":{"line":188,"column":1,"offset":7251},"end":{"line":188,"column":15,"offset":7265},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"One of the underpinning requirements of the pact verification process is the ability to make the\npact files generated by the consumer available to the provider. When the pact verification is run\nin an automated pipeline this is difficult without an intermediary. Within the Pact framework,\nthe ","position":{"start":{"line":190,"column":1,"offset":7267},"end":{"line":193,"column":5,"offset":7561},"indent":[1,1,1]}},{"type":"inlineCode","value":"Pact Broker","position":{"start":{"line":193,"column":5,"offset":7561},"end":{"line":193,"column":18,"offset":7574},"indent":[]}},{"type":"text","value":" provides the facility for consumers and providers to share the pact definitions\nwith minimal dependencies between the systems.","position":{"start":{"line":193,"column":18,"offset":7574},"end":{"line":194,"column":47,"offset":7701},"indent":[1]}}],"position":{"start":{"line":190,"column":1,"offset":7267},"end":{"line":194,"column":47,"offset":7701},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Additionally, the Pact Broker provides a place to define webhooks to trigger the provider build\nprocess when the pact definition changes and a way record and visualise the results of the\nverification process. The high-level interaction is shown below:\n","position":{"start":{"line":196,"column":1,"offset":7703},"end":{"line":199,"column":1,"offset":7955},"indent":[1,1,1]}},{"type":"image","title":null,"url":"./PactFramework-pactbroker.png","alt":"Pact broker interactions","position":{"start":{"line":199,"column":1,"offset":7955},"end":{"line":199,"column":60,"offset":8014},"indent":[]}}],"position":{"start":{"line":196,"column":1,"offset":7703},"end":{"line":199,"column":60,"offset":8014},"indent":[1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Starter kits","position":{"start":{"line":201,"column":4,"offset":8019},"end":{"line":201,"column":16,"offset":8031},"indent":[]}}],"position":{"start":{"line":201,"column":1,"offset":8016},"end":{"line":201,"column":16,"offset":8031},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The Starter kits have been built with the frameworks necessary to generate and publish pacts for \napi consumers and verify against pacts and publish the results for api providers. The pipelines \nwill do all the publishing and verification against Pact Broker if an instance of Pact Broker has\nbeen configured within the cluster.","position":{"start":{"line":203,"column":1,"offset":8033},"end":{"line":206,"column":36,"offset":8361},"indent":[1,1,1]}}],"position":{"start":{"line":203,"column":1,"offset":8033},"end":{"line":206,"column":36,"offset":8361},"indent":[1,1,1]}},{"type":"export","value":"export const _frontmatter = {}","position":{"start":{"line":209,"column":1,"offset":8364},"end":{"line":209,"column":31,"offset":8394},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":209,"column":31,"offset":8394}}},"scopeImports":[],"scopeIdentifiers":[],"rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\nimport DefaultLayout from \"/home/jenkins/workspace/dev/dev-ibm-garage-cloud.ibm-garage-developer-guide.sms-pipeline/node_modules/gatsby-theme-carbon/src/templates/Default.js\"\nexport const _frontmatter = {};\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\nconst PageDescription = makeShortcode(\"PageDescription\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <PageDescription mdxType=\"PageDescription\">\n      <p>{`Use Pact to test your code’s API`}</p>\n    </PageDescription>\n    <p>{`In IBM Garage Method, one of the Develop practices is `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.ibm.com/garage/method/practices/code/contract-driven-testing\"\n      }}>{`contract-driven testing`}</a>{`.\nPact automates contract testing and enables it to be added to a continuous integration pipeline.\nThe Developer Tools environment’s Jenkins pipeline includes a Pact stage.\nSimply by building your app using the Jenkins pipeline, your code’s contract gets tested, just open the Pact UI to browse the results.`}</p>\n    <h2 {...{\n      \"id\": \"what-is-contract-testing\"\n    }}>{`What is contract testing`}</h2>\n    <p><em parentName=\"p\">{`Contract testing`}</em>{` is a testing discipline that ensures two applications (a consumer and\na provider) have a shared understanding of the interactions or the `}<em parentName=\"p\">{`contract`}</em>{` between them.`}</p>\n    <p>{`The Pact framework has been selected for the provided tool set. Pact is a\nconsumer-driven contract testing framework. More details can be found here -\n`}<a parentName=\"p\" {...{\n        \"href\": \"https://docs.pact.io/\"\n      }}>{`Pact overview`}</a>{`. The framework has been built into the Starter Kits\nand a Pact Broker instance is provisioned in the cluster along with the other tools.`}</p>\n    <p>{`In `}<inlineCode parentName=\"p\">{`consumer-driven contract testing`}</inlineCode>{` it is the consumer who defines the `}<inlineCode parentName=\"p\">{`contract`}</inlineCode>{` in terms of the\nexpected interactions, the data structure, and the expected responses. That `}<inlineCode parentName=\"p\">{`contract`}</inlineCode>{` can then be used\non the consumer-side to mock the interactions and validate the consumer behavior. More importantly,\nthe `}<inlineCode parentName=\"p\">{`contract`}</inlineCode>{` can be shared with the provider of the interaction so that the provider’s responses\ncan be validated to ensure the consumer’s expectations are met.`}</p>\n    <p>{`In the Pact framework, the contract is called a `}<inlineCode parentName=\"p\">{`pact`}</inlineCode>{`. A `}<inlineCode parentName=\"p\">{`pact`}</inlineCode>{` consists of one or more\n`}<inlineCode parentName=\"p\">{`interactions`}</inlineCode>{`. Each `}<inlineCode parentName=\"p\">{`interaction`}</inlineCode>{` has the following structure:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`Given a *state* of {state}\n\n*upon receiving* a {description} request\n\n*with request* parameters\n- HTTP method\n- path\n- headers\n- body\n\n*will respond with* values like\n- status\n- headers\n- body\n`}</code></pre>\n    <p>{`where:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`{state} is an optional string that describes the initial state. This value can be used by the\nprovider during testing to make sure the preconditions are met`}</li>\n      <li parentName=\"ul\">{`{description} is a unique description of the interaction`}</li>\n      <li parentName=\"ul\">{`the request parameters can contain any values that describe the interaction`}</li>\n      <li parentName=\"ul\">{`the response contains the relevant information for the consumer. The response values can be exact values\nor using matchers for type, regular expressions, etc`}</li>\n    </ul>\n    <h2 {...{\n      \"id\": \"consumer\"\n    }}>{`Consumer`}</h2>\n    <p>{`Using the Pact framework libraries in conjunction with the unit testing framework on the consumer, the\n`}<inlineCode parentName=\"p\">{`pact`}</inlineCode>{` for the interaction between the consumer and provider is generated and validated. As part of the\npact test setup, a Pact server is started and configured with the expected interactions. All of the consumer\nservice invocations are directed at the Pact server which provides mock responses based on the\ninteractions defined by the `}<inlineCode parentName=\"p\">{`pact`}</inlineCode>{`. At the end of the test, if all the interactions completed successfully\na file containing the pact definition is generated.`}</p>\n    <p>{`The following diagram gives an overview of the consumer interactions:\n`}<span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"607px\"\n        }\n      }}>{`\n      `}<span parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-background-image\",\n          \"style\": {\n            \"paddingBottom\": \"108.89621087314663%\",\n            \"position\": \"relative\",\n            \"bottom\": \"0\",\n            \"left\": \"0\",\n            \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsSAAALEgHS3X78AAACC0lEQVQ4y42U544CMQyEef93AyEh8QOJ3ntdOvj0WZqV2exxFymQdZzx2J6kYoUxn8+tWq1avV63RqNhj8fDbreb1Wo163a71mq17HA4WNl4v99WOR6Ppsnhy+Vii8XCgVerldter5ctl0vb7/e22+3ser26nTOn08myLHMfRgXHZrNpk8nEmeA8m81sOp3adru15/Ppjuv12sbjsQeTX7/f9yzww+aARCIykVgziUh02J7PZ5+ssbF3v9/dj9RhzDfpOiA/sFMqAiEAUWEFWw5hY5/JHkQ2m01eP68hH0QuDqX6zUbdCJ4AEp1aDodDZ0szVBMOqTHYtI6gAsxThjaTFJg0AGBKwLrT6dhgMLB2u+2NIDBpUyZmwjB2UwMbbLBrSi6sxRi/Dx3Gw7FWMCgTbnHoXJIyEiAi616v56mRJh2GGXKhzhK/Ok39E0AJEyPspLPYEAaixpcrSF0JTgOTGrKBxgDT3R2NRvmVIgD/XEdkoquKf5TcB2DUE4cB44C++SdQUTJq5kfK1IaawYA1kgGw2Ailr/TEPkkZEPQmB5ogYcsxAkaGscs5oC74X1ePw5Ex61JAJACgBIwTLFlzc9SAMmErEw0HpKOwZFOvDSAAUE/eR9bY9JTxTTD2ZGM6IBsxRenxPy8QlwB9MulDLpvYhLLu6VVSl/VNBknK0ty37v3WZVKPfj+ayLNBucbMvAAAAABJRU5ErkJggg==')\",\n            \"backgroundSize\": \"cover\",\n            \"display\": \"block\"\n          }\n        }}></span>{`\n  `}<img parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-image\",\n          \"alt\": \"Pact consumer interactions\",\n          \"title\": \"Pact consumer interactions\",\n          \"src\": \"/ibm-garage-developer-guide/static/39dbe818c7125f745c85a2314aa88d5b/e77bb/PactFramework-consumer.png\",\n          \"srcSet\": [\"/ibm-garage-developer-guide/static/39dbe818c7125f745c85a2314aa88d5b/d6747/PactFramework-consumer.png 288w\", \"/ibm-garage-developer-guide/static/39dbe818c7125f745c85a2314aa88d5b/09548/PactFramework-consumer.png 576w\", \"/ibm-garage-developer-guide/static/39dbe818c7125f745c85a2314aa88d5b/e77bb/PactFramework-consumer.png 607w\"],\n          \"sizes\": \"(max-width: 607px) 100vw, 607px\",\n          \"loading\": \"lazy\"\n        }}></img>{`\n    `}</span></p>\n    <p>{`An example pact test on a Typescript consumer using the jest testing framework is provided below. It has\nbeen broken into several parts.`}</p>\n    <h3 {...{\n      \"id\": \"pact-server-config\"\n    }}>{`Pact server config`}</h3>\n    <p>{`At the beginning of the test file, the pact server is configured and started in the\n`}<inlineCode parentName=\"p\">{`beforeAll()`}</inlineCode>{` block. The `}<inlineCode parentName=\"p\">{`afterAll()`}</inlineCode>{` block finalizes the pacts by writing them out\nto a file and stopping the pact server.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-typescript\"\n      }}>{`  const port = 1234;\n  const baseUrl = \\`http://localhost:\\${port}\\`;\n  let pact: Pact;\n  beforeAll(() => {\n    pact = new Pact({\n      consumer: consumerName,\n      provider: providerName,\n      logLevel: 'error',\n      port,\n    });\n\n    return pact.setup();\n  });\n\n  afterAll(() => {\n    return pact.finalize()\n      .catch(err => console.error('Error finalizing pact', err));\n  });\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"setup-the-service\"\n    }}>{`Setup the service`}</h3>\n    <p>{`Next, an instance of the component that will be tested is loaded and configured with the\npact server host and port as the base url used for the interactions. In this example,\nthe consumer is using the `}<inlineCode parentName=\"p\">{`typescript-ioc`}</inlineCode>{` library to inject the `}<inlineCode parentName=\"p\">{`baseUrl`}</inlineCode>{` config value\ninto the service.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-typescript\"\n      }}>{`  let service: SampleApi;\n  beforeAll(() => {\n    Container\n      .bind(MyServiceConfig)\n      .provider({get: () => ({baseUrl})});\n    \n    service = Container.get(SampleService);\n  });\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"define-and-test-the-interaction\"\n    }}>{`Define and test the interaction`}</h3>\n    <p>{`For each interaction with the provider, a test similar to the one provided below is created. In\nit, the Pact framework is used to define the interaction. The `}<inlineCode parentName=\"p\">{`addInteraction()`}</inlineCode>{` publishes the\ninteraction to the Pact server so that it can be used to provide a mock response when the\nrequest is made.`}</p>\n    <p>{`The mock response is then used to validate the behavior of the component that is being tested.\nThe example below is simple and passes the provider response directly through the service api\nbut in more sophisticated examples the value would be transformed.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-typescript\"\n      }}>{`  describe('given createWidget()', () => {\n    context('when called with valid request', () => {\n      const widgetRequest = {...};\n      const widgetResponse = {...};\n      \n      beforeEach(() => {\n        return pact.addInteraction({\n          uponReceiving: 'a valid widget request',\n          withRequest: {\n            method: 'POST',\n            path: '/widgets',\n            headers: {\n              'Content-Type': 'application/json',\n              'Accept': 'application/json',\n            },\n            body: widgetRequest,\n          },\n          willRespondWith: {\n            status: 200,\n            headers: {\n              'Content-Type': Matchers.regex({\n                generate: 'application/json', matcher: 'application/json.*'\n              }),\n            },\n            body: Matchers.like(widgetResponse),\n          },\n        });\n      });\n\n      test('then return 200 status', async () => {\n        expect(await service.createWidget(widgetRequest)).toEqual(widgetResponse);\n      });\n    });\n  });\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"provider\"\n    }}>{`Provider`}</h2>\n    <p>{`The provider uses the Pact framework to verify the running server against the `}<inlineCode parentName=\"p\">{`pact`}</inlineCode>{`, either\none started locally as part of the test or another instance running elsewhere. The interactions\nin the pact are sent to the provider by a mock consumer in the Pact framework and the results\nare verified against the expected results defined by the pact.`}</p>\n    <p>{`As an optional configuration for the verification process, an endpoint can be provided that handles\nthe state information in the pact in order to ensure the preconditions for the test are met. (E.g.\nstate=“given an empty database”). In order for these tests to be repeatable, it is often advisable\nto stand up a clean backend to run the pact tests when the tests start and tear it down when the\ntests are completed. For example, if a provider interacts with a Cloudant database point the\ntest provider at a new database instance for the tests.`}</p>\n    <p>{`The following diagram shows the interactions for the pact provider:\n`}<span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"401px\"\n        }\n      }}>{`\n      `}<span parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-background-image\",\n          \"style\": {\n            \"paddingBottom\": \"107.48129675810473%\",\n            \"position\": \"relative\",\n            \"bottom\": \"0\",\n            \"left\": \"0\",\n            \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAABlklEQVQ4y5WUba+CMAyF+f8/jmAiET9gREXAqB/Ed5CaZ0kJd26E26RZGdvZaXu2IM9zmc1mMp/PJQxDOZ1OcrvdBOu6TmzTuff7LVVVSVmWst1uzVjXtQTn81mSJDGAjI/HYxJg0zRyuVzkeDzKarWSw+EgbdtKcL1eDQDAnECsm8YAGdl7v98NMDEe6EJOHC5WdwHb36/Xq58LNHg+n/L5fLyMXAxdew1DPqgBLCk2o83YZToPwz+A/Fiv15JlmSyXS1PkzWbTL/o3IJamqQHF6NYQzFfTUYa73c50ybXBZmW7s4aIE2a2UVOkgZyIXTbMqAfc7/e9ntAjMUDUNY5jiaLIxKo71Sz7yE6tByyKwjDgNDqs4zBtYlWAruEAsut1qIDcRZ8NG+L6h+R+UuaR0GunDGBMB1EATozTBHVKhMR+GFIHagMIC3UzzoPBnBbfdtL+YUjKrqs3xZw6hDYdI7XFYmE6yo3hSeON9Glw9KZonUiBFPVtVP35HgrvTdGHdezeTgYkZViNpTaJoWvSp7kpDL8rymy+bY1CRwAAAABJRU5ErkJggg==')\",\n            \"backgroundSize\": \"cover\",\n            \"display\": \"block\"\n          }\n        }}></span>{`\n  `}<img parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-image\",\n          \"alt\": \"Pact provider interactions\",\n          \"title\": \"Pact provider interactions\",\n          \"src\": \"/ibm-garage-developer-guide/static/5b87a6af5243f5b34ff2164e1f6370d6/1e3c2/PactFramework-provider.png\",\n          \"srcSet\": [\"/ibm-garage-developer-guide/static/5b87a6af5243f5b34ff2164e1f6370d6/d6747/PactFramework-provider.png 288w\", \"/ibm-garage-developer-guide/static/5b87a6af5243f5b34ff2164e1f6370d6/1e3c2/PactFramework-provider.png 401w\"],\n          \"sizes\": \"(max-width: 401px) 100vw, 401px\",\n          \"loading\": \"lazy\"\n        }}></img>{`\n    `}</span></p>\n    <h2 {...{\n      \"id\": \"pact-broker\"\n    }}>{`Pact Broker`}</h2>\n    <p>{`One of the underpinning requirements of the pact verification process is the ability to make the\npact files generated by the consumer available to the provider. When the pact verification is run\nin an automated pipeline this is difficult without an intermediary. Within the Pact framework,\nthe `}<inlineCode parentName=\"p\">{`Pact Broker`}</inlineCode>{` provides the facility for consumers and providers to share the pact definitions\nwith minimal dependencies between the systems.`}</p>\n    <p>{`Additionally, the Pact Broker provides a place to define webhooks to trigger the provider build\nprocess when the pact definition changes and a way record and visualise the results of the\nverification process. The high-level interaction is shown below:\n`}<span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"481px\"\n        }\n      }}>{`\n      `}<span parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-background-image\",\n          \"style\": {\n            \"paddingBottom\": \"43.86694386694386%\",\n            \"position\": \"relative\",\n            \"bottom\": \"0\",\n            \"left\": \"0\",\n            \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABX0lEQVQoz3WQ62qDQBBG9/1fpvRXQ1vohTYN5ioGG5oGzaVqvMaouNlVv7o2yhLSgWFFZg7nGzLbTTA2FUw3Y4y3ClKaQFRVVVffsizB2QkrO4O2OUE1EsyMFPoPQ2/ogCgrBY+TB/QX71CtKRIJeAljjCFJkrqP+DRDLOwSH3Mbb+oOy32Fu9EeZB2a2EQmzMDAwtJBOf3XUMDaCpIChkthujl2YYFtwKCuDiCQilLatGzYAvM8b4BhGCKO4+ZflqbgnJ23/+aIvEhPFJ7ndQstjHOOtIYV9ev7PtIGxDtjcdeWQeRjR1EEy7IaYJplnbn4Ls5zbcnx22qAsolceRBgPRrC0nW4cw359xKZadSWrIkv4gpb27bhOE6XishHb1roC+O9A3uoQNc0rF+eEL8+wx/0kRwOyGpjkUhEF6bibW9PLpW7u3kujsoAX/c9zG9v4NZAps9RFbwdvhr5F3HvszutCAiZAAAAAElFTkSuQmCC')\",\n            \"backgroundSize\": \"cover\",\n            \"display\": \"block\"\n          }\n        }}></span>{`\n  `}<img parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-image\",\n          \"alt\": \"Pact broker interactions\",\n          \"title\": \"Pact broker interactions\",\n          \"src\": \"/ibm-garage-developer-guide/static/a7a882a6504c5c1ab5ba0e4cf7d13345/1d8cf/PactFramework-pactbroker.png\",\n          \"srcSet\": [\"/ibm-garage-developer-guide/static/a7a882a6504c5c1ab5ba0e4cf7d13345/d6747/PactFramework-pactbroker.png 288w\", \"/ibm-garage-developer-guide/static/a7a882a6504c5c1ab5ba0e4cf7d13345/1d8cf/PactFramework-pactbroker.png 481w\"],\n          \"sizes\": \"(max-width: 481px) 100vw, 481px\",\n          \"loading\": \"lazy\"\n        }}></img>{`\n    `}</span></p>\n    <h2 {...{\n      \"id\": \"starter-kits\"\n    }}>{`Starter kits`}</h2>\n    <p>{`The Starter kits have been built with the frameworks necessary to generate and publish pacts for\napi consumers and verify against pacts and publish the results for api providers. The pipelines\nwill do all the publishing and verification against Pact Broker if an instance of Pact Broker has\nbeen configured within the cluster.`}</p>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}